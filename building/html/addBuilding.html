<div class="lm-popup">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" ng-click="cancel()" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
        <h3 class="modal-title">{{'ADD_BUILDING'| translate}}</h3>
    </div>
    <form name="addBuildingForm" novalidate>
        <div class="modal-body">
            <div class="container-fluid">
                <div class='row'>
                    <div class='col-md-12'>
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.buildingTypeId.$error.required && afterSubmit">{{'BUILDING_TYPE'| translate}}{{ 'REQUIRED' | translate}} *</div>
                                <div>{{serverError.buildingTypeId.toString()}}</div>
                                <div>{{serverError.buildingType.toString()}}</div>
                            </div>
                            <select id="buildingType" ng-change="getBuildingName(building.buildingTypeId)"
                                    class="form-control" name="buildingTypeId" ng-model = "building.buildingTypeId"
                                    ng-options="type.buildingTypeId  as type.type for type in types" required>
                                <option disabled hidden value="">{{'SELECT_BUILDING_TYPE'| translate}}*</option>
                            </select>
                        </div>
                    </div>
                    <div class='col-md-12'>
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.buildingname.$error.required && afterSubmit">{{'BUILDING_NAME'| translate}} {{ 'REQUIRED' | translate}}*</div>
                                <div  ng-show = "addBuildingForm.buildingname.$dirty && addBuildingForm.buildingname.$invalid">
                                    <div ng-show="addBuildingForm.buildingname.$error.pattern">{{'BUILDING_NAME'| translate}} {{ 'INVALID' | translate}}</div>
                                    <div ng-show="addBuildingForm.buildingname.$error.maxlength">{{'BUILDING_NAME'| translate}} {{ 'LONG' | translate}}</div>
                                </div>
                                <div ng-hide="addBuildingForm.buildingname.key">{{serverError.buildingname.toString()}}</div>
                            </div>
                            <input id="buildingName" class="form-control" name="buildingname" ng-model = "building.buildingname" placeholder="{{'BUILDING_NAME'| translate}}*"
                                   ng-pattern="/^[a-zA-Z0-9\u0621-\u064A\u0660-\u0669][a-zA-Z0-9\u0621-\u064A\u0660-\u0669 -]*[a-zA-Z0-9\u0621-\u064A\u0660-\u0669]+$/" required ng-maxlength="32"
                                   ng-keydown="backendVisibilityService.checkKey(addBuildingForm.buildingname, serverError)"/>
                        </div>
                    </div>
                </div>

                <div class='row'>
                    <div class='col-md-12'>
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.countryId.$error.required && afterSubmit">{{'BUILDING_COUNTRY'| translate}} {{ 'REQUIRED' | translate}}*</div>
                                <div>{{serverError.countryId.toString()}}</div>
                                <div>{{serverError.countryname.toString()}}</div>
                            </div>
                            <select id="country" ng-change="getCities(building.countryId)" class="form-control"
                                    name="countryId" ng-model = "building.countryId"
                                    ng-options="country.countryId  as country.name for country in countries" required>
                                <option disabled hidden value="">{{'SELECT_COUNTRY'| translate}}*</option>
                            </select>
                        </div>
                    </div>
                    <div class='col-md-12'>
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.cityId.$error.required && afterSubmit">{{'BUILDING_CITY'| translate}}{{ 'REQUIRED' | translate}}*</div>
                                <div>{{serverError.cityId.toString()}}</div>
                                <div>{{serverError.cityname.toString()}}</div>
                            </div>
                            <select id="city" class="form-control" name="cityId" ng-model = "building.cityId"
                                    ng-options="city.cityId  as city.name for city in cities" required>
                                <option disabled hidden value="">{{'SELECT_CITY'| translate}} *</option>
                            </select>
                        </div>
                    </div>
                    <div class='col-md-12'>
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.area.$error.pattern">{{'AREA'| translate}} {{ 'INVALID' | translate}}</div>
                                <div ng-show="addBuildingForm.area.$error.maxlength && !addBuildingForm.area.$error.pattern">{{'AREA'| translate}} {{ 'LONG' | translate}}</div>
                                <div>{{serverError.area.toString()}}</div>
                            </div>
                            <input id="area" class="form-control" name="area" ng-maxlength="32"
                                   ng-pattern="/^[a-zA-Z0-9\- \u0621-\u064A\u0660-\u0669]*$/" ng-model = "building.area" placeholder="{{'AREA'| translate}}"
                                   ng-maxlength="32" ng-keydown="backendVisibilityService.checkKey(addBuildingForm.area, serverError)"/>
                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class='col-md-6'>
                        <div class="form-group">
                            <div class="error-container">
                                <div  ng-show = "addBuildingForm.street.$dirty && addBuildingForm.street.$invalid">
                                    <div ng-show="addBuildingForm.street.$error.pattern">{{'STREET'| translate}} {{ 'INVALID' | translate}}</div>
                                    <div ng-show="addBuildingForm.street.$error.maxlength">{{'STREET'| translate}}{{ 'LONG' | translate}}</div>
                                </div>
                                <div ng-hide="addBuildingForm.street.key">{{serverError.street.toString()}}</div>
                            </div>
                            <input id="street" class="form-control" name="street" ng-model = "building.street" placeholder="{{'STREET_NAME'| translate}}"
                                   ng-pattern="/^[a-zA-Z0-9\- \u0621-\u064A\u0660-\u0669]*$/"
                                   ng-maxlength="32" ng-keydown="backendVisibilityService.checkKey(addBuildingForm.street, serverError)"/>
                        </div>
                    </div>
                    <div class='col-md-6'>
                        <div class="form-group">
                            <div class="error-container">
                                <div  ng-show = "addBuildingForm.buildingnumber.$dirty && addBuildingForm.buildingnumber.$invalid">
                                    <div ng-show="addBuildingForm.buildingnumber.$error.pattern">{{'BUILDING_NUMBER'| translate}} {{ 'INVALID' | translate}}</div>
                                    <div ng-show="addBuildingForm.buildingnumber.$error.maxlength">{{'BUILDING_NUMBER'| translate}}{{ 'LONG' | translate}}</div>
                                </div>
                                <div ng-hide="addBuildingForm.buildingnumber.key">{{serverError.buildingnumber.toString()}}</div>
                            </div>
                            <input id="buildingNumber" class="form-control" name="buildingnumber" ng-model = "building.buildingnumber" placeholder="{{'BUILDING_NUMBER'| translate}}"
                                   ng-maxlength="32" ng-pattern="/^[a-zA-Z0-9\u0621-\u064A\u0660-\u0669]*$/"
                                   ng-keydown="backendVisibilityService.checkKey(addBuildingForm.buildingnumber, serverError)"/>
                        </div>
                    </div>
                </div>
                <div class="row ">
                    <div class='col-md-6'>
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.countryCode.$error.required && afterSubmit">{{'COUNTRY_CODE'| translate}}{{ 'REQUIRED' | translate}} *</div>
                                <div>{{serverError.countryCodeId.toString()}}</div>
                            </div>
                            <select class="form-control" name="countryCode" ng-model = "building.countryCodeId"
                                    ng-options="countryCode.id as countryCode.name+' ('+countryCode.code+')' for countryCode in countryCodes" required>
                                <option disabled hidden value="">{{'SELECT_COUNTRY_CODE'| translate}}*</option>
                            </select>
                        </div>
                    </div>
                    <div class='col-md-6'>
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.phoneNumber.$error.required && afterSubmit">{{'PHONE_NUMBER'| translate}} {{ 'REQUIRED' | translate}}*</div>
                                <div  ng-show = "addBuildingForm.phoneNumber.$dirty && addBuildingForm.phoneNumber.$invalid">
                                    <div ng-show="addBuildingForm.phoneNumber.$error.pattern">{{'BUILDING_NUMBER'| translate}} {{ 'INVALID' | translate}}</div>
                                    <div ng-show="addBuildingForm.phoneNumber.$error.maxlength">{{'BUILDING_NUMBER'| translate}}{{ 'LONG' | translate}}</div>
                                </div>
                                <div ng-hide="addBuildingForm.phoneNumber.key">{{serverError.phoneNumber.toString()}}</div>
                            </div>
                            <input class="form-control" name="phoneNumber" ng-model = "building.phoneNumber" placeholder="{{'PHONE_NUMBER'| translate}} *"
                                   ng-maxlength="32" ng-pattern="/^[0-9\u0660-\u0669]*$/" ng-required="true"
                                   ng-keydown="backendVisibilityService.checkKey(addBuildingForm.phoneNumber, serverError)"/>
                        </div>
                    </div>
                </div>
                <!--<div class="row ">-->
                <!--                    <div class='col-md-4'>
                                        <div class="form-group">
                                            <div class="error-container">
                                                <div ng-show="addBuildingForm.waselcode.$error.required && afterSubmit">{{'WASEL_CODE'| translate}} {{ 'REQUIRED' | translate}}</div>
                                                <div  ng-show = "addBuildingForm.waselcode.$dirty && addBuildingForm.waselcode.$invalid">
                                                    <div ng-show="addBuildingForm.waselcode.$error.pattern">{{'WASEL_CODE'| translate}} {{ 'INVALID' | translate}}</div>
                                                    <div ng-show="addBuildingForm.waselcode.$error.maxlength">{{'WASEL_CODE'| translate}} {{ 'LONG' | translate}}</div>
                                                </div>
                                                <div>{{serverError.waselcode.toString()}}</div>
                                            </div>
                                            <input id="waselCode" class="form-control" name="waselcode" ng-model = "building.waselcode" placeholder="{{'WASEL_CODE'| translate}}"
                                                   ng-pattern="/^[a-zA-Z0-9\_\- \u0621-\u064A\u0660-\u0669]*$/"
                                                   ng-maxlength="32">
                                        </div>
                                    </div>-->
                <!--<div class='col-md-8'>-->
                <div class="form-group row">
                    <div class="col-md-6">
                        <div class="error-container">
                            <div ng-show="addBuildingForm.latitude.$error.required && afterSubmit">{{'LATITUDE'| translate}} {{ 'REQUIRED' | translate}}</div>
                            <div  ng-show = "addBuildingForm.latitude.$dirty && addBuildingForm.latitude.$invalid">
                                <div ng-show="addBuildingForm.latitude.$error.pattern">{{'LATITUDE'| translate}} {{ 'INVALID' | translate}}</div>
                                <div ng-show="addBuildingForm.latitude.$error.max">{{'LATITUDE'| translate}} {{ 'INVALID' | translate}}</div>
                                <div ng-show="addBuildingForm.latitude.$error.min">{{'LATITUDE'| translate}} {{ 'INVALID' | translate}}</div>
                            </div>
                            <div>{{serverError.latitude.toString()}}</div>
                        </div>
                        <input ng-change="checkMapValidation()" id="latitude"  class="form-control hide-spinner" name="latitude" ng-model = "building.latitude" placeholder="{{'LATITUDE'| translate}} *"
                               required ng-pattern="/^-?([1-8]?[0-9]\.{1}\d{1,17}$|90\.{1}0{1,17}$)|^-?([1-8]?[0-9]|90)$/" ng-change="(addBuildingForm.latitude.$valid && addBuildingForm.longitude.$valid) ? centerMap() : null"/>
                    </div>
                    <div class="col-md-6">
                        <div class="error-container">
                            <div ng-show="addBuildingForm.longitude.$error.required && afterSubmit">{{'LONGITUDE'| translate}} {{ 'REQUIRED' | translate}}</div>
                            <div  ng-show = "addBuildingForm.longitude.$dirty && addBuildingForm.longitude.$invalid">
                                <div ng-show="addBuildingForm.longitude.$error.pattern">{{'LONGITUDE'| translate}} {{ 'INVALID' | translate}}</div>
                                <div ng-show="addBuildingForm.longitude.$error.max">{{'LONGITUDE'| translate}}{{ 'INVALID' | translate}}</div>
                                <div ng-show="addBuildingForm.longitude.$error.min">{{'LONGITUDE'| translate}}{{ 'INVALID' | translate}}</div>
                            </div>
                            <div>{{serverError.longitude.toString()}}</div>
                        </div>
                        <input ng-change="checkMapValidation()" id="longitude" class="form-control hide-spinner" name="longitude" ng-model = "building.longitude" placeholder="{{'LONGITUDE'| translate}}*"
                               required ng-pattern="/^-?((([1]?[0-7][0-9]|[1-9]?[0-9])\.{1}\d{1,16}$)|[1]?[1-8][0]\.{1}0{1,16}$)|^-?((([1]?[0-7][0-9]|[1-9]?[0-9]))$|[1]?[1-8][0]$)/" ng-change="(addBuildingForm.latitude.$valid && addBuildingForm.longitude.$valid) ? centerMap() : null"/>

                    </div>
                </div>
                <!--</div>-->
                <!--</div>-->

                <div class='row'>
                    <div class="col-lg-12">
                        <div class="error-container">
                            <div ng-show="afterSubmit">{{polygenError| translate}}</div>
                            {{serverError.buildingServingArea.toString()}}
                        </div>
                        <div class="error-container">
                            <div ng-show="afterSubmit">{{pointError| translate}}</div>
                        </div>
                        <!--<div class="buildingMap" id="map_canvas"></div>-->
                        <div ng-if="mapLoadingError">
                            {{"CANT_LOAD_MAP"|translate}}
                        </div>
                        <div ng-if="!mapLoadingError" map-lazy-load="https://maps.google.com/maps/api/js"
                             map-lazy-load-params="{{googleMapsUrl}}" >
                            <ng-map class="buildingMap" id="AddBuildingMap" zoom="{{zoom}}" on-click="clickOnMapEvent(event)" center="{{center}}"
                                    scrollwheel='false' disable-default-u-i="true" zoom-control="true">
                                <marker ng-if="building.latitude && building.longitude" draggable="true" on-dragend="setBuildingLocation()" position="{{building.latitude}},{{building.longitude}}" icon="commons/images/building.png"></marker>
                                <shape id="polygon" name="polygon"  ng-if="polygen[0][1]"
                                       stroke-color="gray" on-click="clickOnMapEvent(event)
                                       stroke-opacity="1.0" stroke-weight="2"
                                       paths="{{polygen}}">
                                </shape>
                                <shape id="buildingsLocation" name="polygon" ng-repeat="location in buildingsLocation"
                                       stroke-color="red" on-click="clickOnMapEvent(event)
                                       stroke-opacity="1.0" stroke-weight="2"
                                       paths="{{location}}">
                                </shape>
                                <marker ng-repeat="location in polygen" ng-if="location[1]" position="{{location[0]}}, {{location[1]}}" icon="http://maps.google.com/mapfiles/ms/icons/yellow-dot.png" on-click="removePolygenMarker(event,$index)"></marker>
                                <!--<div ng-repeat="location in buildingsLocation">-->
                                <!--<marker ng-repeat="pos in location" position="{{pos[0]}}, {{pos[1]}}" icon="http://maps.google.com/mapfiles/ms/icons/purple-dot.png"></marker>-->
                                <!--</div>-->

                            </ng-map>
                        </div>
                        <div class="margin-top-10">
                            <button class="btn btn-default" ng-show="addMarker" ng-click="toggleAddMarker()" ng-disabled="addBuildingForm.longitude.$invalid || addBuildingForm.latitude.$invalid">
                                <span>{{'DRAWPOLYGON'| translate }}</span>
                            </button>
                            <button class="btn btn-default" ng-hide="addMarker" ng-disabled="polygen === undefined || polygen === null || polygen.length == 0" ng-click="removeAllPolygenMarkers()">{{'REM_POL_MAR'| translate}}</button>
                        </div>
                    </div>
                </div>
                <div class='row'>
                    <div class="col-lg-12 margin-bottom-15">
                        <div class="form-group">
                            <div class="error-container">
                                <div ng-show="addBuildingForm.description.$error.maxlength">{{'DESCRIPTION'| translate}}{{ 'LONG' | translate}}</div>
                                {{serverError.description.toString()}}
                            </div>
                            <textarea id="description" class="form-control" placeholder="{{'DESCRIPTION_OPTIONAL'| translate}}" rows="3"
                                      ng-model = "building.description" name="description" ng-maxlength="500"></textarea>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn lm-btn blue-btn" ng-click="addBuilding()" data-toggle="tooltip" ng-disabled="requestProcessing"
                        data-placement="top" title="Submit" id="addBuildingBtn" type="submit">{{'SUBMIT'| translate}}</button>
            </div>
        </div>
    </form>
</div>